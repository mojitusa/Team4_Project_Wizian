<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="utf-8">
<meta content="width=device-width, initial-scale=1.0" name="viewport">
<title>중앙 - 상담 시스템</title>

<script src="https://code.jquery.com/jquery-3.6.0.js"></script>
<link rel="stylesheet"
	href="//code.jquery.com/ui/1.13.2/themes/base/jquery-ui.css">
<script src="https://code.jquery.com/ui/1.13.2/jquery-ui.js"></script>
<link rel="stylesheet"
	href="https://cdn.jsdelivr.net/npm/sweetalert2@11.4.10/dist/sweetalert2.min.css">
<script
	src="https://cdn.jsdelivr.net/npm/sweetalert2@11.4.10/dist/sweetalert2.min.js"></script>
<link
	href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css"
	rel="stylesheet">
<script
	src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"></script>
	
<link href="assets/vendor/bootstrap-icons/bootstrap-icons.css"
	rel="stylesheet">
<link href="assets/vendor/aos/aos.css" rel="stylesheet">
<link href="assets/vendor/glightbox/css/glightbox.min.css"
	rel="stylesheet">
<link href="assets/vendor/swiper/swiper-bundle.min.css" rel="stylesheet">

<link href="assets/css/main.css" rel="stylesheet">
<link href="assets/css/professor.css" rel="stylesheet">
<style type="text/css">
/* Global styles */
body {
    font-family: Arial, sans-serif;
    background-color: #f8f9fa;
    color: #333;
}

/* Main */
.professor {
    padding: 20px 0;
}

/* First row: 지도교수 여부, 학과 검색 */
#professorSection .row {
    display: flex;
    justify-content: space-between;
    margin-bottom: 20px;
}

#professorSection .row span {
    display: flex;
    align-items: center;
}

#professorSection .row label {
    margin-right: 10px;
}

/* Second row: 검색창과 검색 버튼 */
#professorSection .search-container {
    margin-bottom: 20px;
}

#professorSection .search-container label {
    margin-right: 10px;
}

/* Third row: 그리드 시스템으로 리스트 표시 */
#professorSection table {
    width: 100%;
    border-collapse: collapse;
}

#professorSection table, #professorSection th, #professorSection td {
    border: 1px solid #ddd;
    padding: 8px;
}

#professorSection th {
    background-color: #f2f2f2;
}

.modal-header, .modal-footer {
    background-color: #f2f2f2;
}

.modal-title {
    color: #333;
}

.modal-body p {
    margin: 10px 0;
}

</style>
</head>

<body class="index-page">
	<header class="header">
		<div th:replace="../templates/fragments/header"></div>
	</header>

	<main class="professor">
		<section id="professorSection">
			<div class="container">

				<div class="row">
					<span> <label for="map_professor">지도교수여부</label> <select
						id="map_professor">
							<option value="yes">Y</option>
							<option value="no">N</option>
					</select>
					</span> <span> <label for="department">학과</label> <input
						type="text" id="department_search" placeholder="학과를 입력하세요">
						<button id="department_search_button">검색</button>
					</span>
				</div>

				<div>
					<label for="search">검색</label> <input type="text" id="search"
						placeholder="검색어를 입력하세요">
					<button id="search_button">검색하기</button>
				</div>
				
				<div th:if="${profData}">
					<table border="1">
						<thead>
							<tr>
								<th>번호</th>
								<th>이름</th>
								<th>상담분야</th>
								<th>프로필</th>
								<th>상담신청</th>
							</tr>
						</thead>
						<tbody>
							<tr th:each="prof, iterStat : ${profData}">
								<td th:text="${iterStat.count}">No</td>
								<td th:text="${prof.PF_NM}">ID</td>
								<td th:text="${prof.PF_CS_PART}">Name</td>
								<td>
									<button type="button" class="btn btn-info" th:attr="onclick='showProfModal(' + ${prof.PF_NO} + ')'">조회</button>
								</td>
								<td>
									<a th:href="@{'/calendar?profNo=' + ${prof.PF_NO}}" class="btn btn-primary">일정조회</a>
								</td>
							</tr>
						</tbody>
					</table>
				</div>
				<div th:if="${#lists.isEmpty(profData)}">
					<p>No professor data found.</p>
				</div>
			</div>


			<div class="modal fade" id="professorModal" tabindex="-1"
				aria-labelledby="professorModalLabel" aria-hidden="true">
				<div class="modal-dialog">
					<div class="modal-content">
						<div class="modal-header">
							<h5 class="modal-title" id="professorModalLabel">교수 상세 정보</h5>
							<button type="button" class="btn-close" data-bs-dismiss="modal"
								aria-label="Close"></button>
						</div>
						<div class="modal-body">
							<p>
								<strong>이름:</strong> <span id="profName"></span>
							</p>
							<p>
								<strong>연락처:</strong> <span id="profContact"></span>
							</p>
							<p>
								<strong>소속:</strong> <span id="profDepartment"></span>
							</p>
							<p>
								<strong>이메일:</strong> <span id="profEmail"></span>
							</p>
							<p>
								<strong>상담장소:</strong> <span id="profLocation"></span>
							</p>
							<p>
								<strong>상담분야:</strong> <span id="profField"></span>
							</p>
							<p>
								<strong>담당 학부:</strong> <span id="profCollege"></span>
							</p>
						</div>
						<div class="modal-footer">
							<button type="button" class="btn btn-secondary"
								data-bs-dismiss="modal">닫기</button>
						</div>
					</div>
				</div>
			</div>




		</section>
	</main>

	<script th:inline="javascript">
		//교수 프로필 보기
		function showProfModal(pfNo){
		    console.log(pfNo);
			var profData  = /*[[${profData}]]*/[];
			console.log(profData );
			
			// pfNo와 profData 배열의 PF_NO 값을 비교하여 일치하는 객체를 찾기
	        var selectedProf = profData.find(function(prof) {
	        	return prof.PF_NO.toString() === pfNo.toString();
	        });
			
	        if (selectedProf) {
	            // 모달에 교수 정보를 표시하는 코드를 여기에 추가합니다.
	            document.getElementById('profName').innerText = selectedProf.PF_NM;
	            document.getElementById('profContact').innerText = selectedProf.PF_TELNO;
	           	document.getElementById('profDepartment').innerText = selectedProf.C_NMK;  
	           	document.getElementById('profEmail').innerText = selectedProf.email;	
	            document.getElementById('profLocation').innerText = selectedProf.PF_PLC_NM;
	            document.getElementById('profField').innerText = selectedProf.PF_CS_PART;

	            // 모달을 표시합니다.
	            $('#professorModal').modal('show');
	        } else {
	            console.log("교수 정보를 찾을 수 없습니다.");
	        }
		}
	
		// Ajax 요청을 보내는 함수
		function searchDepartment() {
			var department = $("#department_search").val();

			// Ajax 요청 보내기
			$.ajax({
				url : "/searchProfDepartment",
				method : "POST",
				data : {
					department : department
				},
				success : function(response) {
					console.log("검색 결과:", response);
					// 여기서 검색 결과를 처리하여 원하는 동작 수행
				},
				error : function(xhr, status, error) {
					console.error("검색 요청 실패:", error);
				}
			});
		}

		// 검색 버튼 클릭 시 검색 함수 호출
		$(function() {
			$("#department_search_button").click(function() {
				searchDepartment();
			});
		});
		
	</script>
</body>

<footer id="footer">
	<div th:replace="../templates/fragments/footer"></div>
</footer>

</html>