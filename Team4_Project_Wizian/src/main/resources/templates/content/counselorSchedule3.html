<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="utf-8">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">
  <title>중앙 - 상담 신청</title>

  <!-- jQuery -->
  <script src="https://code.jquery.com/jquery-3.6.0.js"></script>
  <!-- jQuery UI -->
  <link rel="stylesheet" href="//code.jquery.com/ui/1.13.2/themes/base/jquery-ui.css">
  <script src="https://code.jquery.com/ui/1.13.2/jquery-ui.js"></script>
  <!-- SweetAlert -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11.4.10/dist/sweetalert2.min.css">
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.4.10/dist/sweetalert2.min.js"></script>
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"></script>

  <!-- Vendor CSS Files -->
  <link href="assets/vendor/bootstrap-icons/bootstrap-icons.css" rel="stylesheet">
  <link href="assets/vendor/aos/aos.css" rel="stylesheet">
  <link href="assets/vendor/glightbox/css/glightbox.min.css" rel="stylesheet">
  <link href="assets/vendor/swiper/swiper-bundle.min.css" rel="stylesheet">

  <!-- Main CSS File -->
  <link href="assets/css/main.css" rel="stylesheet">
  <link href="assets/css/sex.css" rel="stylesheet">
  
  
  <!-- Main CSS File -->
  <style>
    #calendar {
      margin: 20px 0;
    }
    #calendar table {
      width: 100%;
      border-collapse: collapse;
    }
    #calendar th, #calendar td {
      border: 1px solid #ddd;
      padding: 8px;
      text-align: center;
    }
    #calendar th {
      background-color: #f2f2f2;
    }
    .week-nav {
      display: flex;
      justify-content: space-between;
      margin-bottom: 10px;
    }
    
    .calendar-button {
      padding: 5px 10px;
      margin: 2px;
    }
        
  </style>  
  
  
</head>

<body class="index-page">
	<header class="header">
		<div th:replace="../templates/fragments/header"></div>

	</header>
  
  <main class="sch">
    <section id="sexSection">
      <div class="container">
        <!-- Content here -->
        <div class="week-nav">
          <button id="prevWeek">이전 주</button>
          <span id="calTitle"></span>
          <button id="nextWeek">다음 주</button>
        </div>
        <div id="calendar"></div>
        
      </div>
    </section>
  </main>
  
  <!-- Thymeleaf에서 스케줄 데이터를 JSON으로 전달 -->
  <script th:inline="javascript">
      /*<![CDATA[*/
      const schedules = /*[[${schedules}]]*/ [];
      /*]]>*/
  </script>  
  
    <script type="text/javascript">
        console.log(schedules);

        document.addEventListener('DOMContentLoaded', () => {
            // 요일 배열
            const days = ['일', '월', '화', '수', '목', '금', '토'];

            // 초기 날짜 (오늘)
            let currentDate = new Date();

            // 주간 달력 생성 함수
            function generateCalendar(date) {
                // 월요일부터 일요일까지의 날짜 가져오기
                const dates = [];
                const startOfWeek = new Date(date);
                startOfWeek.setDate(date.getDate() - date.getDay() + 1); // 월요일로 설정
                for (let i = 0; i < 7; i++) {
                    const current = new Date(startOfWeek);
                    current.setDate(startOfWeek.getDate() + i);
                    dates.push(current);
                }

                // 달력 HTML 생성
                let calendarHTML = '<table>';
                calendarHTML += '<tr><th>시간</th>' + dates.map(d => `<th>${d.getMonth() + 1}.${d.getDate()}(${days[d.getDay()]})</th>`).join('') + '</tr>';

                // 시간대 추가
                const hours = ['09:00', '10:00', '11:00', '12:00', '13:00', '14:00', '15:00', '16:00', '17:00', '18:00'];
                hours.forEach(hour => {
                    calendarHTML += '<tr><td>' + hour + '</td>' + dates.map((d, i) => `<td id="${d.getFullYear()}-${d.getMonth() + 1}-${d.getDate()}-${hour}"></td>`).join('') + '</tr>';
                });

                calendarHTML += '</table>';

                // 달력을 페이지에 삽입
                document.getElementById('calendar').innerHTML = calendarHTML;

                // 스케줄 데이터를 달력에 추가
                schedules.forEach(schedule => {
                    const date = new Date(schedule.date);
                    console.log(date);
                    const time = new Date(schedule.time);
                    console.log(time);
                    const timeString = `${time.getHours()}:${time.getMinutes() < 10 ? '0' : ''}${time.getMinutes()}`;
                    addDataToCalendar(date, timeString, '예약', 'appointment-button');
                });
            }

            // 데이터를 달력에 추가하는 함수
            function addDataToCalendar(date, time, content, buttonClass) {
                const cell = document.getElementById(`${date.getFullYear()}-${date.getMonth() + 1}-${date.getDate()}-${time}`);
                if (cell) {
                    const button = document.createElement('button');
                    button.textContent = content;
                    button.classList.add('calendar-button', buttonClass);
                    cell.appendChild(button);
                }
            }

            // 초기 달력 생성
            generateCalendar(currentDate);

            // 이전 주 버튼 클릭 이벤트
            document.getElementById('prevWeek').addEventListener('click', () => {
                currentDate.setDate(currentDate.getDate() - 7);
                generateCalendar(currentDate);
            });

            // 다음 주 버튼 클릭 이벤트
            document.getElementById('nextWeek').addEventListener('click', () => {
                currentDate.setDate(currentDate.getDate() + 7);
                generateCalendar(currentDate);
            });
        });
    </script>

  
</body>

  <footer id="footer">
    <div th:replace="../templates/fragments/footer"></div>
  </footer>

</html>