<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="utf-8">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">
  <title>중앙 - 상담 시스템</title>

  <!-- jQuery -->
  <script src="https://code.jquery.com/jquery-3.6.0.js"></script>
  <!-- jQuery UI -->
  <link rel="stylesheet" href="//code.jquery.com/ui/1.13.2/themes/base/jquery-ui.css">
  <script src="https://code.jquery.com/ui/1.13.2/jquery-ui.js"></script>
  <!-- SweetAlert -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11.4.10/dist/sweetalert2.min.css">
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.4.10/dist/sweetalert2.min.js"></script>
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"></script>
  <!-- Tempus Dominus Bootstrap 4 datetimepicker CSS -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/tempusdominus-bootstrap-4/5.39.0/css/tempusdominus-bootstrap-4.min.css" rel="stylesheet">
  <!-- Tempus Dominus Bootstrap 4 datetimepicker JS -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/tempusdominus-bootstrap-4/5.39.0/js/tempusdominus-bootstrap-4.min.js"></script>
  <!-- Main CSS File -->
  <link href="assets/css/main.css" rel="stylesheet">
  <link href="assets/css/group.css" rel="stylesheet">
</head>

<body class="index-page">
  <header class="header">
    <div th:replace="~{../templates/fragments/header}"></div>
  </header>

  <main class="groupBox">
    <section id="groupWriteSection">
      <div class="gcpage3">
        <div class="gcpa">상담 등록</div>
        <br>
        <form>
          <div class="gcgroupRegisterBox1">
            <div class="nameBox1">프로그램 이름</div>
            <div class="gcgroupRegisterInput1">
              <input type="text" name="PRGRM_NM" required placeholder="프로그램 이름을 입력하세요.">
            </div>
          </div>
          <br>
          <div class="gcgroupRegisterBox1">
            <div class="nameBox1">모집시작일정</div>
            <div class="gcgroupRegisterInput2">
              <input type="text" id="SCHDL_BGNG_YMD" name="SCHDL_BGNG_YMD" required placeholder="모집시작 날짜를 입력하세요.">
            </div>
            <div class="nameBox2">모집끝일정</div>
            <div class="gcgroupRegisterInput3">
              <input type="text" id="SCHDL_END_YMD" name="SCHDL_END_YMD" required placeholder="모집끝 날짜를 입력하세요.">
            </div>
          </div>
          <div class="gcgroupRegisterBox1">
            <div class="nameBox1">집단상담 일정</div>
            <div class="gcgroupRegisterInput2">
              <input type="text" id="GC_DT" name="GC_DT" required placeholder="상담 날짜를 입력하세요.">
            </div>
            <div class="nameBox2">정원</div>
            <div class="gcgroupRegisterInput3">
              <input type="number" name="NOPE" required placeholder="정원을 입력하세요.">
            </div>
          </div>
          <div class="gcgroupRegisterBox1">
            <div class="nameBox1">집단상담 유형</div>
            <div class="gcgroupRegisterInput2">
              <input type="text" name="PRGRM_TYPE" required placeholder="프로그램 유형을 입력하세요.">
            </div>
            <div class="nameBox2">주최기관명</div>
            <div class="gcgroupRegisterInput3">
              <input type="text" name="GC_OG_NM" required placeholder="주최기관 이름을 입력하세요.">
            </div>
          </div>
          <br>
          <div class="gcgroupRegisterBox1">
            <div class="nameBox1">집단상담 개요</div>
            <div class="gcgroupRegisterInput4">
              <textarea name="counselingContent" required placeholder="프로그램에 대한 설명을 입력하세요."></textarea>
            </div>
          </div>
          <div class="gcgroupRegisterBox1">
            <div class="nameBox1">집단상담 포스터</div>
            <div class="gcgroupRegisterInput4">
              <textarea name="posterContent" required></textarea>
            </div>
          </div>
          <div class="submit-button">
            <button id="validate-button" type="button" style="margin-left: 10px; width: 100px; height: 40px;">양식검사</button>
            <button id="submit-button" type="submit" style="margin-left: 10px; width: 100px; height: 40px; display:none;" disabled>등록하기</button>
          </div>
        </form>
        <br><br>
        <div style="display: flex; justify-content: space-between;">
          <div>
            <a th:href="@{./group }">
              <button id="cancelBtn" style="margin-left: 10px; width: 100px; height: 40px;">취 소</button>
            </a>
          </div>
        </div>
      </div>
    </section>
  </main>

  <script>
    $(document).ready(function() {
      // Datepicker 설정
      $("#SCHDL_BGNG_YMD, #SCHDL_END_YMD").datepicker({
        dateFormat: "yy_mm_dd" // 날짜 형식 설정
      });

      $('#GC_DT').datetimepicker({
	    format: 'YYYY-MM-DD HH:mm:ss' // 날짜 및 시간 형식 설정
	  });

      $('#validate-button').click(function() {
        // 유효성 검사 플래그
        var isValid = true;

        // 입력값 가져오기
        var PRGRM_NM = $('input[name="PRGRM_NM"]').val();
        var SCHDL_BGNG_YMD = $('input[name="SCHDL_BGNG_YMD"]').val();
        var SCHDL_END_YMD = $('input[name="SCHDL_END_YMD"]').val();
        var GC_DT = $('input[name="GC_DT"]').val();
        var NOPE = $('input[name="NOPE"]').val();
        var PRGRM_TYPE = $('input[name="PRGRM_TYPE"]').val();
        var GC_OG_NM = $('input[name="GC_OG_NM"]').val();
        var counselingContent = $('textarea[name="counselingContent"]').val();
        var posterContent = $('textarea[name="posterContent"]').val();

        // 유효성 검사 함수 정의
        function validateDate(dateString) {
          var regex = /^\d{4}_\d{2}_\d{2}$/; // YYYY_MM_DD 형식 검사
          return regex.test(dateString);
        }

        function validateDateTime(dateTimeString) {
          var regex = /^\d{4}_\d{2}_\d{2} \d{2}:\d{2}:\d{2}$/; // YYYY_MM_DD HH:MM:SS 형식 검사
          return regex.test(dateTimeString);
        }

        // 유효성 검사
        if (!PRGRM_NM || !SCHDL_BGNG_YMD || !SCHDL_END_YMD || !GC_DT || !NOPE || !PRGRM_TYPE || !GC_OG_NM || !counselingContent || !posterContent) {
          isValid = false;
          Swal.fire({
            title: "입력되지 않은 항목이 있습니다.",
            icon: "error",
            confirmButtonText: "확인"
          });
          return; // 유효성 검사 실패 시 나머지 검사 생략
        }

        if (!validateDate(SCHDL_BGNG_YMD) || !validateDate(SCHDL_END_YMD) || !validateDateTime(GC_DT)) {
          isValid = false;
          Swal.fire({
            title: "잘못된 형식의 날짜 또는 시간이 있습니다.",
            icon: "error",
            confirmButtonText: "확인"
          });
          return; // 유효성 검사 실패 시 나머지 검사 생략
        }

        // 유효성 검사 통과시 등록 버튼 활성화 및 유효성 검사 버튼 숨기기
        if (isValid) {
          Swal.fire({
            title: "유효성 검사를 통과했습니다.",
            icon: "success",
            confirmButtonText: "확인"
          });
          $('#validate-button').hide();
          $('#submit-button').prop('disabled', false).show();
        } else {
          Swal.fire({
            title: "입력한 정보의 양식이 잘못되었습니다!",
            icon: "error",
            confirmButtonText: "확인"
          });
        }
      });

      $('#submit-button').click(function(event) {
        event.preventDefault(); // 기본 이벤트 동작을 막음

        var PRGRM_NM = $('input[name="PRGRM_NM"]').val();
        var SCHDL_BGNG_YMD = $('input[name="SCHDL_BGNG_YMD"]').val();
        var SCHDL_END_YMD = $('input[name="SCHDL_END_YMD"]').val();
        var GC_DT = $('input[name="GC_DT"]').val();
        var NOPE = $('input[name="NOPE"]').val();
        var PRGRM_TYPE = $('input[name="PRGRM_TYPE"]').val();
        var GC_OG_NM = $('input[name="GC_OG_NM"]').val();
        var counselingContent = $('textarea[name="counselingContent"]').val();
        var posterContent = $('textarea[name="posterContent"]').val();

        var formData = {
          PRGRM_NM: PRGRM_NM,
          SCHDL_BGNG_YMD: SCHDL_BGNG_YMD,
          SCHDL_END_YMD: SCHDL_END_YMD,
          GC_DT: GC_DT,
          NOPE: NOPE,
          PRGRM_TYPE: PRGRM_TYPE,
          GC_OG_NM: GC_OG_NM,
          counselingContent: counselingContent,
          posterContent: posterContent
        };

        $.ajax({
          type: 'POST',
          url: '/groupWrite',
          data: formData,
          success: function(response) {
            Swal.fire({
              title: "프로그램 등록이 완료되었습니다.",
              icon: "success",
              confirmButtonText: "확인"
            }).then(function() {
              window.location.href = "/group";
            });
          },
          error: function(xhr, status, error) {
            Swal.fire({
              title: "프로그램 등록이 실패하였습니다.",
              icon: "warning",
              confirmButtonText: "확인"
            }).then(function() {
              window.location.href = "/group";
            });
          }
        });
      });
    });
  </script>
  <footer id="footer">
    <div th:replace="~{../templates/fragments/footer}"></div>
  </footer>
</body>
</html>